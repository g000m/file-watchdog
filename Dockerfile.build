FROM almalinux:8

# Install dependencies
RUN dnf install -y \
    python3 \
    python3-pip \
    gcc \
    glibc-devel \
    && dnf clean all

WORKDIR /app

# Copy files
COPY file_watcher.py ./

# Install Python dependencies
RUN pip3 install --upgrade pip
RUN pip3 install pyinstaller watchdog requests toml

# Build with PyInstaller with static linking
RUN pyinstaller --onefile --name kh-file-watcher-static --strip file_watcher.py

# Make executable
RUN chmod +x dist/kh-file-watcher-static
